import { Image, Notes, Appear, Embed } from '@mdx-deck/components'  
import { FullScreenCode, Invert } from 'mdx-deck/layouts'

import future from '@mdx-deck/themes/future'
import aspect from '@mdx-deck/themes/aspect'
import highlight from '@mdx-deck/themes/syntax-highlighter-prism'
import customTheme from './theme'

export const themes = [future, aspect, highlight, customTheme]

## The Pragmatic Front-end Tester

---

I wanted to talk about testing the front-end.

<Notes>
Soy de Brasil.

  "Who's writing FE apps? Who's testing? Are you confiden? Would you ship
  without manually testing?"

Over the years, FE apps have increased in complexity, responsibility has moved 
from the backend to the FE. 
</Notes>

---

...and I wanted to do it following a pragmatic approach.

<Notes>
  Diapos en ingles porque estaba preparando la charla en ingles, no por postureo.
  Bueno y por postureo un poco tambi√©n.
</Notes>

---

## Some Facts

<Appear>

I have ~30 minutes üèÉ‚Äç‚ôÇÔ∏è

<s>Why should we test?</s>

<s>Testing beyond avoiding regressions</s>

<s>Visual regression testing</s>

Focused on front-end apps

</Appear>

<Notes>
  Focus on avoiding regressions, not discovering best ways of developing a feature

  Frontend apps: Ni Node ni librerias ni otros contextos
</Notes>

---

# üëã

## Adri√† Fontcuberta

Senior(?) Front-end Engineer @ Holaluz

`afontcu.dev` &nbsp;&nbsp;¬∑&nbsp;&nbsp; `@afontcu_` &nbsp;&nbsp;¬∑&nbsp;&nbsp; `npx afontcu`

<Notes>
  Holaluz: Electrica BCN tenemos 200.000 clientes donde vendemos energia verde y solo energia verde, y pretendemos crear una relaci√≥n de confianza con nuestros clientes, algo un poco inusual en el sector como ya sabr√©is.
</Notes>

---

<Invert>

<Image src="images/drake-1.jpg" size="contain" />

</Invert>

---

<Invert>

<Image src="images/drake-2.jpg" size="contain" />

</Invert>

---

So...

I'm sorry I'm gonna use a Counter component

# ü§∑‚Äç‚ôÄÔ∏è

---

```jsx
const Counter = {
  render() {
    return (
      <div>
        <p class="count">You clicked {this.count} times</p>
        <button onClick={this.increment}>increment</button>
      </div>
    )
  },

  data: () => ({ count: 0 }),

  methods: {
    increment() { this.count++ },
  },
}
```

---

```
import { mount } from '@vue/test-utils'
import Counter from './Counter'

test('increments value on click', () => {
  const wrapper = mount(Counter)
  const paragraph = wrapper.find('.count')

  expect(paragraph.text()).toBe('You clicked 0 times')

  wrapper.vm.increment()
  wrapper.vm.increment()

  expect(paragraph.text()).toBe('You clicked 2 times')
})
```

---

thanks for coming to my Ted Talk.
 
---

```jsx
const Counter = {
  render() {
    return (
      <div>
        <p class="count">You clicked {this.count} times</p>
        <button onClick={this.increment}>increment</button>
      </div>
    )
  },

  data: () => ({ count: 0 }),

  methods: {
    increment() { this.count++ },
  },
}
```

---

```jsx
const Counter = {
  render() {
    return (
      <div>
        <p class="count">You clicked {this.count} times</p>
        <button onClick={() => this.count++}>increment</button>
      </div>
    )
  },

  data: () => ({ count: 0 }),
}
```

---

```jsx
const Counter = {
  render() {
    return (
      <div>
        <p class="counter">You clicked {this.count} times</p>
        <button onClick={() => this.count++}>increment</button>
      </div>
    )
  },

  data: () => ({ count: 0 }),
}
```

---

<span style={{ fontSize: '11rem' }}>‚ùå</span>

```py
find() did not return .counter, cannot call text() on empty Wrapper
```

```py
TypeError: wrapper.vm.increment is not a function
```

---

<Image src="images/kalisi.jpg" size="cover" />

---

False negative.

---

This undermines our confidence in testing.

_"Tests fail at random times"_

---

## ‚ö†Ô∏è Implementation details ‚ö†Ô∏è

---

<Appear>

### 1. Your test does something code's consumers won't

Who consumes your code?

1) End users

2) Other devs

3) Tests ‚ùå

</Appear>

<Notes>
  If test is doing something different from user & developer, it becomes a third
  consumer.
  User: input interactions, output side effects
  Dev: input props, output elements, event
</Notes>

---


<Appear>

### 2. Your test breaks on refactor

_"a change made to the internal structure of software [...] without changing its observable behavior."_ - Martin Fowler himself

</Appear>


<Notes>
  Exemple canviar nom de m√®tode.

  This undermines our confidence in testing. They fail at random times.
</Notes>

---

`dom-testing-library`

<Appear>

> ‚ÄúThe more your tests resemble the way your software is used, the more confidence they can give you.‚Äù - _Kent C. Dodds_

</Appear>

---

`vue-testing-library`

`react-testing-library`

`svelte-testing-library`

`angular-testing-library`

...

<Notes>

Built on top of vue test utils. Hides methods that get you closer to testing
implementation details, while providing user-focused helpers.

If you want to avoid impl details, use tools that help you out.

Helps you querying for nodes similarly to how users would find them.

</Notes>

---

```js
import { render, fireEvent } from 'vue-testing-library'
import Counter from './Counter'

test('increments value on click', async () => {
  const { getByText } = render(Counter)

  getByText(/you clicked 0 times/i)                              

  const button = getByText(/increment/i)

  await fireEvent.click(button) 
  await fireEvent.click(button) 

  getByText(/you clicked 2 times/i)
})
```

---

```js
import { render, fireEvent } from 'vue-testing-library'
import Counter from './Counter'

test('increments value on click', async () => {
  const { getByText } = render(Counter)

  getByText(/you clicked 0 times/i)      // query as a user would

  const button = getByText(/increment/i) // query as a user would

  await fireEvent.click(button)          // act as a user would
  await fireEvent.click(button)          // act as a user would

  getByText(/you clicked 2 times/i)      // query as a user would
})
```

---


```jsx
import { render, fireEvent } from 'react-testing-library'
import Counter from './Counter'

test('increments value on click', async () => {
  const { getByText } = render(<Counter />)

  getByText(/you clicked 0 times/i)      // query as a user would

  const button = getByText(/increment/i) // query as a user would

  await fireEvent.click(button)          // act as a user would
  await fireEvent.click(button)          // act as a user would

  getByText(/you clicked 2 times/i)      // query as a user would
})
```

---

<span style={{ fontSize: '11rem' }}>‚úÖ</span>

---

(kinda) framework agnostic

# üëç

---

Yeah well, sure. It's just a Counter, so whatever.

---

```jsx
import { mapActions, mapState } from 'vuex'

const Counter = {
  render() {
    return (
      <div>
        <p class="count">You clicked {this.count} times</p>
        <button onClick={this.increment}>increment</button>
      </div>
    )
  },

  computed: { ...mapState(['count']) },

  methods: { ...mapActions(['increment']) },
}
```

---

```js
const store = {
  state: {
    count: 0,
  },

  actions: {
    increment: ({ commit, state }) =>
      commit('SET_COUNT', state.count + 1),
  },

  mutations: {
    SET_COUNT: (state, count) => {
      state.count = count
    },
  },
}
```

---

```js
import { render, fireEvent } from 'vue-testing-library'
import CounterStore from './CounterStore.js'
import store from './store.js'

test('increments value on click', async () => {
  const { getByText } = render(CounterStore, { store })

  getByText(/you clicked 0 times/i)

  const button = getByText(/increment/i)

  await fireEvent.click(button)
  await fireEvent.click(button)

  getByText(/you clicked 2 times/i)
})
```

---

Let me show you something else.

---

Something that turned writing tests... into a funny activity.

---

# Cypress ‚ù§Ô∏è

<Notes>
  Is an amazing tool to write end-to-end tests. It can test anything that runs
  on a browser (including Vue).

  It includes a ton of tools and features out-of-the-box: mocking/stubbing,
  assertions, DOM selectors...

  Focus on DX. Meant to be used during the development cycle.
</Notes>

---

So...

I'm sorry I'm gonna use a Todo app

# ü§∑‚Äç‚ôÄÔ∏è

---

```js
it('adds 3 todos', () => {
  cy.visit('/')

  cy.getByLabelText(/what needs to be done?/i)
    .type('follow @afontcu_ on Twitter{enter}')
    .type('learn testing with Cypress{enter}')
    .type('stop making demos with Todo apps{enter}')
  
  cy.getAllByTestId('todolist-item')
    .should('have.length', 3)
})
```

---


```html
<div v-for="todo in todos" :key="todo.id">
  <label data-testid="todolist-item">
    {{ todo.title }}
  </label>
</div>
```

---


```js
it('adds 3 todos', () => {
  cy.visit('/')

  cy.getByLabelText(/what needs to be done?/i)
    .type('follow @afontcu_ on Twitter{enter}')
    .type('learn testing with Cypress{enter}')
    .type('stop making demos with Todo apps{enter}')
  
  cy.getAllByTestId('todolist-item')
    .should('have.length', 3)
})
```

---

XHR stubbing

Custom commands (`cy.login()`)

`cypress-testing-library`

---

Hey, Adri.

Why would I write "component" tests if I can use Cypress?

---

That's a pretty good question.

---

<p style={{textAlign:'left'}}>Component tests tend to be **cheaper**.</p>

<p style={{textAlign:'left'}}>Component tests tend to be **faster**.</p>

<p style={{textAlign:'left'}}>Component tests tend to be **more focused**.</p>

<Notes>
  Cheaper to write and run.

  Hit a smaller portion of your codebase.

  Better balance between cost, confidence and scope.

However, we are kinda getting there with tools such as Cypress.
</Notes>

---

## Wrapping up

<Appear>

Write tests, but **not too many**. Focus on ROI.

Use tools that resemble the way your software is used.

I'd use Cypress to cover common happy paths.

I'd add several **component tests** to critical parts and edge cases.

</Appear>


---

## To learn more

[frontend-testing.now.sh](https://frontend-testing.now.sh)

[github.com/afontcu/awesome-learning#testing](https://github.com/afontcu/awesome-learning#testing)

[docs.cypress.io](https://docs.cypress.io)

[testing-library.com](http://testing-library.com)

---

# Thank you! üëã

`afontcu.dev` &nbsp;&nbsp;¬∑&nbsp;&nbsp; `@afontcu_` &nbsp;&nbsp;¬∑&nbsp;&nbsp; `npx afontcu`

---

### oh btw we r hiring k thx bye üëã

üëâ http://tiny.cc/holaluz-frontend üëà

_(more openings at: [holaluz.com/jobs](https://holaluz.com/jobs))_

