import { Image, Notes, Appear, Embed } from '@mdx-deck/components'  
import { FullScreenCode, Invert } from 'mdx-deck/layouts'
import future from '@mdx-deck/themes/future'
import aspect from '@mdx-deck/themes/aspect'

import customTheme from './theme'
import Waver from './Waver'

export const themes = [future, aspect, customTheme]

## The Pragmatic Front-end Tester

---

I wanted to talk about **testing the front-end**.

<Notes>
  "Who's writing FE apps? Who's testing? Are you confiden? Would you ship
  without manually testing?"

Over the years, FE apps have increased in complexity, responsibility has moved 
from the backend to the FE. 
</Notes>

---

...and I wanted to do it following a **pragmatic** approach.

---

## Some Facts

<Appear>

I have ~30 minutes 🏃‍♂️

<s>Why should we test?</s>

<s>Testing beyond avoiding regressions</s>

<s>Visual regression testing</s>

Focused on front-end apps

</Appear>

<Notes>
  Focus on avoiding regressions, not discovering best ways of developing a feature

  Frontend apps: Ni Node ni librerias ni otros contextos
</Notes>

---

## 👋 Hi! I'm Adrià Fontcuberta

Senior(?) Front-end Engineer @ **Holaluz**

`afontcu.dev` &nbsp;&nbsp;·&nbsp;&nbsp; `@afontcu_` &nbsp;&nbsp;·&nbsp;&nbsp; `npx afontcu`

<Notes>
What's the first thing that comes to your mind when talking about software testing?
</Notes>

---

The Testing Pyramid™

---

“Do I need to test each inner method?”

“Should I use mount or shallow mount?”

“Is testing a component a unit test?”

“Why doesn’t glue stick to its own bottle?”

---

<Image src="images/drake-nah.png" size="contain" />

---

<Appear>

Testing your components in a **realistic** environment...

...and focusing on the **confidence** each test provides?

</Appear>

<Notes>
interacting with them as a user would
</Notes>

---

<Image src="images/drake-yea.jpg" size="contain" />

---

Let's see a day-to-day example...

<Notes>
  The kind of component we develop here at Holaluz daily.
</Notes>

---

a Counter component

# 🤷‍♀️

---

```html
<template>
  <div>
    <p class="count">You clicked {{ count }} times</p>
    <button @click="increment">increment</button>
  </div>
</template>

<script>
export default {
  data: () => ({ count: 0 }),

  methods: {
    increment() { this.count++ },
  },
}
</script>
```

---

```
import { mount } from '@vue/test-utils'
import Counter from './Counter'

test('increments value on click', () => {
  const wrapper = mount(Counter)                      
  



  
  

  
})
```

---

```
import { mount } from '@vue/test-utils'
import Counter from './Counter'

test('increments value on click', () => {
  const wrapper = mount(Counter)
  const paragraph = wrapper.find('.count')

  expect(paragraph.text()).toBe('You clicked 0 times')

  
  

  
})
```

---

```
import { mount } from '@vue/test-utils'
import Counter from './Counter'

test('increments value on click', () => {
  const wrapper = mount(Counter)
  const paragraph = wrapper.find('.count')

  expect(paragraph.text()).toBe('You clicked 0 times')

  wrapper.vm.increment()
  wrapper.vm.increment()

  expect(paragraph.text()).toBe('You clicked 2 times')
})
```

---

thanks for coming to my Ted Talk.
 
---

```html
<template>
  <div>
    <p class="count">You clicked {{ count }} times</p>
    <button @click="increment">increment</button>
  </div>
</template>

<script>
export default {
  data: () => ({ count: 0 }),

  methods: {
    increment() { this.count++ },
  },
}
</script>
```

---

```html
<template>
  <div>
    <p class="count">You clicked {{ count }} times</p>
    <button @click="count++">increment</button>
  </div>
</template>

<script>
export default {
  data: () => ({ count: 0 }),
}
</script>
```

---

```html
<template>
  <div>
    <p class="counter">You clicked {{ count }} times</p>
    <button @click="count++">increment</button>
  </div>
</template>

<script>
export default {
  data: () => ({ count: 0 }),
}
</script>
```

---

<span style={{ fontSize: '11rem' }}>❌</span>

```py
find() did not return .counter, cannot call text() on empty Wrapper
```

```py
TypeError: wrapper.vm.increment is not a function
```

---

<Image src="images/kalisi.jpg" size="cover" />

---

**False negative** error.

<Appear>

Our test is broken. Our component is not.

</Appear>

---

This undermines our **confidence** in testing.

“omg tests fail at random times! 😭”

---

# ⚠️ ⚠️ ⚠️️️️️️ 

Smells like **Implementation Details**

---

### Implementation detail #1

<Appear>

Test does something with your code its **consumers** won't.

1) End users

2) Other devs

3) Tests ❌

</Appear>

<Notes>
  If test is doing something different from user & developer, it becomes a third
  consumer.
  User: input interactions, output side effects
  Dev: input props, output elements, event

  wrapper.vm.increment
</Notes>

---

### Implementation detail #2

<Appear>

Your test breaks on **refactor**.

“changing the internal structure without changing its observable behavior.”

</Appear>

<Notes>
  Martin Fowler.

  Changing class name.
</Notes>

---

`dom-testing-library`

<Appear>

> “The more your tests resemble the way your software is used, the more confidence they can give you.” - _Kent C. Dodds_

</Appear>

<Notes>
  Simple and complete testing utilities.

  IT IS NOT a test runner or framework.

  Works with any environment that provides DOM APIs, such as Jest, Mocha + JSDOM, or a real browser
</Notes>

---

`vue-testing-library`

`react-testing-library`

`svelte-testing-library`

`angular-testing-library`

...

<Notes>

Built on top of vue test utils. Hides methods that get you closer to testing
implementation details, while providing user-focused helpers.

If you want to avoid impl details, use tools that help you out.

Helps you querying for nodes similarly to how users would find them.

</Notes>

---

```js
import { render, fireEvent } from 'vue-testing-library'
import Counter from './Counter'

test('increments value on click', async () => {
  const { getByText } = render(Counter)                          

  

  

  
  

  
})
```

---

```js
import { render, fireEvent } from 'vue-testing-library'
import Counter from './Counter'

test('increments value on click', async () => {
  const { getByText } = render(Counter)                          

  getByText(/you clicked 0 times/i)                              

  

  
  

  
})
```

---

```js
import { render, fireEvent } from 'vue-testing-library'
import Counter from './Counter'

test('increments value on click', async () => {
  const { getByText } = render(Counter)                          

  getByText(/you clicked 0 times/i)                              

  const button = getByText(/increment/i)

  await fireEvent.click(button) 
  await fireEvent.click(button) 

  
})
```
---

```js
import { render, fireEvent } from 'vue-testing-library'
import Counter from './Counter'

test('increments value on click', async () => {
  const { getByText } = render(Counter)                          

  getByText(/you clicked 0 times/i)                              

  const button = getByText(/increment/i)

  await fireEvent.click(button) 
  await fireEvent.click(button) 

  getByText(/you clicked 2 times/i)
})
```

---

```js
import { render, fireEvent } from 'vue-testing-library'
import Counter from './Counter'

test('increments value on click', async () => {
  const { getByText } = render(Counter)

  getByText(/you clicked 0 times/i)      // query as a user would

  const button = getByText(/increment/i) // query as a user would

  await fireEvent.click(button)          // act as a user would
  await fireEvent.click(button)          // act as a user would

  getByText(/you clicked 2 times/i)      // query as a user would
})
```

---


```jsx
import { render, fireEvent } from 'react-testing-library'
import Counter from './Counter'

test('increments value on click', async () => {
  const { getByText } = render(<Counter />)

  getByText(/you clicked 0 times/i)      // query as a user would

  const button = getByText(/increment/i) // query as a user would

  await fireEvent.click(button)          // act as a user would
  await fireEvent.click(button)          // act as a user would

  getByText(/you clicked 2 times/i)      // query as a user would
})
```

---

<span style={{ fontSize: '11rem' }}>✅</span>

---

(kinda) framework agnostic

# 👍

---

Yeah well, sure. It's a simple `Counter`, whatever.

---

```html
<template>
  <div>
    <p class="count">You clicked {{ count }} times</p>
    <button @click="increment">increment</button>
  </div>
</template>

<script>
import { mapActions, mapState } from 'vuex'

export default {
  computed: { ...mapState(['count']) },

  methods: { ...mapActions(['increment']) },
}
</script>
```

---

```js
const store = {
  state: {
    count: 0,
  },

  actions: {
    increment: ({ commit, state }) =>
      commit('SET_COUNT', state.count + 1),
  },

  mutations: {
    SET_COUNT: (state, count) => {
      state.count = count
    },
  },
}
```

---

```js
import { render, fireEvent } from 'vue-testing-library'
import CounterStore from './CounterStore.js'


test('increments value on click', async () => {
  const { getByText } = render(CounterStore)

  getByText(/you clicked 0 times/i)

  const button = getByText(/increment/i)

  await fireEvent.click(button)
  await fireEvent.click(button)

  getByText(/you clicked 2 times/i)
})
```

---

```js
import { render, fireEvent } from 'vue-testing-library'
import CounterStore from './CounterStore.js'
import store from './store.js'

test('increments value on click', async () => {
  const { getByText } = render(CounterStore, { store })

  getByText(/you clicked 0 times/i)

  const button = getByText(/increment/i)

  await fireEvent.click(button)
  await fireEvent.click(button)

  getByText(/you clicked 2 times/i)
})
```

---

Vuex is an **implementation detail**.

<Notes>
  I wouldn't suggest mocking store modules.
</Notes>

---

Let me show you something else.

---

Something that turned writing tests...

...into a **wonderful experience**.

---

# Cypress 💚

<Notes>
  Is an amazing tool to write end-to-end tests. It can test anything that runs
  on a browser (including Vue).

  It includes a ton of tools and features out-of-the-box: mocking/stubbing,
  assertions, DOM selectors...

  Focus on DX. Meant to be used during the development cycle.
</Notes>

---

Let's see a day-to-day example...

<Notes>
  The kind of component we develop here at Holaluz daily.
</Notes>

---

a Todo app

# 🤷‍♀️

---

`cypress-testing-library`

---

```js
it('adds 3 todos', () => {
  cy.visit('/')                                     

  
  
  
  
  
  
  
})
```

---

```js
it('adds 3 todos', () => {
  cy.visit('/')

  cy.getByLabelText(/what needs to be done?/i)      
    
    
    
  
  
  
})
```

---

```js
it('adds 3 todos', () => {
  cy.visit('/')

  cy.getByLabelText(/what needs to be done?/i)
    .type('follow @afontcu_ on Twitter{enter}')
    .type('learn testing with Cypress{enter}')
    .type('stop making demos with Todo apps{enter}')
  
  
  
})
```

---

```js
it('adds 3 todos', () => {
  cy.visit('/')

  cy.getByLabelText(/what needs to be done?/i)
    .type('follow @afontcu_ on Twitter{enter}')
    .type('learn testing with Cypress{enter}')
    .type('stop making demos with Todo apps{enter}')
  
  cy.getAllByTestId('todolist-item')
    .should('have.length', 3)
})
```

---


```html
<div v-for="todo in todos" :key="todo.id">
  <label data-testid="todolist-item">
    {{ todo.title }}
  </label>
</div>
```

---


```js
it('adds 3 todos', () => {
  cy.visit('/')

  cy.getByLabelText(/what needs to be done?/i)
    .type('follow @afontcu_ on Twitter{enter}')
    .type('learn testing with Cypress{enter}')
    .type('stop making demos with Todo apps{enter}')
  
  cy.getAllByTestId('todolist-item')
    .should('have.length', 3)
})
```

---

## A Cool Cypress Feature

XHR Stubbing

<Notes>
Stubbing responses enables you to control every aspect of the response, including the response body, the status, headers, and even network delay
</Notes>

---

```js
it('starts with zero items', () => {
                                               
  
  
  
  
  
  
 
 
 

 
 
})
```

---

```js
it('starts with zero items', () => {
  cy.server()                                  
  cy.route({
      url: '/todos', 
      response: [],  
    })
    
  
 
 
 

 
 
})
```


---

```js
it('starts with zero items', () => {
  cy.server()        // Hey Cypress,           
  cy.route({
      url: '/todos', 
      response: [],  
    })
    
  
 
 
 

 
 
})
```

---

```js
it('starts with zero items', () => {
  cy.server()        // Hey Cypress,
  cy.route({
      url: '/todos', // on a /todos request... 
      response: [],  
    })
    
  
 
 
 

 
 
})
```

---

```js
it('starts with zero items', () => {
  cy.server()        // Hey Cypress,
  cy.route({
      url: '/todos', // on a /todos request...
      response: [],  // send back this response
    })
    
  
 
 
 

 
 
})
```

---

```js
it('starts with zero items', () => {
  cy.server()        // Hey Cypress,
  cy.route({
      url: '/todos', // on a /todos request...
      response: [],  // send back this response
    })
    .as('todos')
  
 
 
 

 
 
})
```

---

```js
it('starts with zero items', () => {
  cy.server()        // Hey Cypress,
  cy.route({
      url: '/todos', // on a /todos request...
      response: [],  // send back this response
    })
    .as('todos')
  
  cy.visit('/')
  
  

 
 
})
```

---

```js
it('starts with zero items', () => {
  cy.server()        // Hey Cypress,
  cy.route({
      url: '/todos', // on a /todos request...
      response: [],  // send back this response
    })
    .as('todos')
  
  cy.visit('/')
  
  cy.wait('@todos') // wait for the call

 
 
})
```

---

```js
it('starts with zero items', () => {
  cy.server()        // Hey Cypress,
  cy.route({
      url: '/todos', // on a /todos request...
      response: [],  // send back this response
    })
    .as('todos')
  
  cy.visit('/')
  
  cy.wait('@todos') // wait for the call

  cy.getAllByTestId('todolist-item')
    .should('have.length', 0)
})
```

---

```js
it('shows a loading state if API takes too long', () => {
  cy.server()
  cy.route({ url: '/todos', response: [], delay: 3000 })
    .as('todos')

  

  

  

  
    
})
```

---

```js
it('shows a loading state if API takes too long', () => {
  cy.server()
  cy.route({ url: '/todos', response: [], delay: 3000 })
    .as('todos')

  cy.visit('/')

  cy.getByText(/loading.../i)

  cy.wait('@todos')

  cy.queryByText(/loading.../i)
    .should('not.exist')
})
```

---

Hey, Adri.

Why would I write "component" tests...

...if I can use **Cypress**?

---

That's a pretty good question.

---

<p style={{textAlign:'left'}}>Component tests tend to **be cheaper**.</p>

<p style={{textAlign:'left'}}>Component tests tend to **be faster**.</p>

<p style={{textAlign:'left'}}>Component tests tend to **narrower**.</p>

<p style={{textAlign:'left'}}>Component tests tend to **focus on simpler problems**.</p>

<Notes>
  Cheaper to write and run.

  Hit a smaller portion of your codebase.

  Better balance between cost, confidence and scope.

However, we are kinda getting there with tools such as Cypress.
</Notes>

---

## The key

Always focus on the **confidence** they provide.

<Notes>

Finding a good balance between component-level tests and app-level tests.

</Notes>

---

## Wrapping up

<Appear>

Write tests, but **not too many**.

Use tools that resemble the way your software is **used**.

Use Cypress to cover **common happy paths**.

Add **component tests** to test critical parts and edge cases.

</Appear>

<Notes>
  1) Focus on ROI

  3) Cypress is also an amazing development tool.

  4) Component tests also to complex components.
</Notes>


---

## To learn more

<p style={{textAlign:'left'}}>Slides: [frontend-testing.now.sh](https://frontend-testing.now.sh)</p>

<p style={{textAlign:'left'}}>Awesome Learning: [github.com/afontcu/awesome-learning](https://github.com/afontcu/awesome-learning#testing)</p>

<p style={{textAlign:'left'}}>Cypress docs: [docs.cypress.io](https://docs.cypress.io)</p>

<p style={{textAlign:'left'}}>Testing library docs: [testing-library.com](http://testing-library.com)</p>

---

# That's all! <Waver />

`afontcu.dev` &nbsp;&nbsp;·&nbsp;&nbsp; `@afontcu_` &nbsp;&nbsp;·&nbsp;&nbsp; `npx afontcu`

<br /><br />

<Appear>

<small>
  oh btw we're hiring! come test components with me:<br />
  <a href="http://holaluz.com/jobs">holaluz.com/jobs</a>
</small>

</Appear>
